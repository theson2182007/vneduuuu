<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vnEdu - M·∫°ng gi√°o d·ª•c Vi·ªát Nam</title>
    <style>
        /* --- RESET & GENERAL --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, Helvetica, sans-serif; }
        body { background-color: #f5f5f5; height: 100vh; overflow-x: hidden; }
        
        /* --- LOGIN PAGE --- */
        #login-screen { display: flex; width: 100%; height: 100vh; background: white; }
        .login-left {
            flex: 1; background-color: #eaf6ff; display: flex; flex-direction: column;
            justify-content: center; align-items: center; position: relative;
            background-image: radial-gradient(#dcecfa 10%, transparent 10%), radial-gradient(#dcecfa 10%, transparent 10%);
            background-size: 30px 30px; background-position: 0 0, 15px 15px;
        }
        .login-logo-big { font-size: 50px; font-weight: bold; color: #0072bc; margin-bottom: 20px; }
        .login-logo-big span { color: #f7941d; position: relative; }
        .login-logo-big span::after { content: 'üéì'; font-size: 30px; position: absolute; top: -10px; right: -25px; }
        .login-slogan { color: #666; font-size: 14px; margin-bottom: 50px; }
        .login-illustration {
            width: 80%; height: 300px;
            background: #e0e0e0 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="%23e0e0e0"/></svg>') no-repeat center center; 
            background-size: contain; border-radius: 10px;
        }
        .login-right { flex: 0.8; padding: 40px 60px; display: flex; flex-direction: column; justify-content: center; background: white; max-width: 600px; }
        .login-title { color: #00407a; font-size: 28px; font-weight: bold; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; position: relative; }
        .form-label { display: block; font-weight: bold; font-size: 13px; color: #555; margin-bottom: 8px; }
        .input-box { width: 100%; padding: 12px 15px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; outline: none; }
        .password-icon { position: absolute; right: 15px; top: 38px; cursor: pointer; color: #888; }
        .login-btn { background-color: #008bf8; color: white; border: none; padding: 12px; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .login-btn:hover { background-color: #0072bc; }
        .qr-section { margin-left: 20px; text-align: center; }
        .qr-box { width: 100px; height: 100px; border: 2px solid #000; padding: 2px; background: #f0f0f0; }

        /* --- DASHBOARD --- */
        #dashboard-screen { display: none; background: #f0f3f6; min-height: 100vh; padding-bottom: 50px; }
        .top-bar { background-color: #0068ac; color: white; padding: 0 20px; height: 50px; display: flex; justify-content: space-between; align-items: center; }
        .user-info { display: flex; align-items: center; gap: 10px; cursor: pointer; position: relative;}
        .user-avatar { width: 30px; height: 30px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #0068ac; }
        
        .logout-menu {
            position: absolute; top: 45px; right: 0; background: white; color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); border-radius: 4px; display: none; width: 180px; z-index: 100;
        }
        .logout-menu div { padding: 10px; cursor: pointer; font-size: 13px; border-bottom: 1px solid #eee; }
        .logout-menu div:hover { background: #f5f5f5; }

        .sub-header { background: white; padding: 15px 0; text-align: center; border-bottom: 3px solid #0068ac; margin-bottom: 20px; }
        .student-title { color: #0068ac; font-weight: bold; font-size: 16px; margin-bottom: 5px; }
        .school-name { font-size: 13px; color: #666; }

        .container { width: 1200px; max-width: 98%; margin: 0 auto; background: white; border: 1px solid #dcdcdc; border-radius: 4px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .filter-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        .filters select { padding: 5px; border: 1px solid #ddd; border-radius: 3px; cursor: pointer; margin-left: 5px; }
        
        /* Update button */
        .update-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            margin-left: 10px;
            display: none;
        }
        .update-btn:hover {
            background-color: #218838;
        }

        /* SUMMARY BOXES */
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .card-title { color: #0072bc; font-weight: bold; font-size: 13px; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        .result-box { background: #f9f9f9; padding: 10px; border-radius: 4px; }
        .result-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; font-size: 12px; }
        .badge { font-weight: bold; padding: 2px 8px; border-radius: 3px; font-size: 11px; }
        .badge-kha { color: #333; } .badge-tot { color: #333; }
        .award-box { background: #fff5eb; padding: 15px; border-radius: 4px; text-align: center; color: #d68100; font-size: 12px; }

        /* TABLES */
        .table-section-title { font-size: 11px; font-weight: bold; margin: 20px 0 5px 0; text-transform: uppercase; color: #333; }
        .score-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 10px; }
        .score-table th { background: #fff5eb; border: 1px solid #e0e0e0; padding: 12px 8px; color: #444; font-weight: bold; text-align: center; font-size: 11px; white-space: nowrap; }
        .score-table td { border: 1px solid #e0e0e0; padding: 8px; text-align: center; color: #0072bc; font-weight: 500; }
        .score-table td:first-child { text-align: left; color: #333; font-weight: normal; font-weight: 500; }
        
        /* Editable cells */
        .editable-cell {
            border: 1px dashed #0072bc !important;
            padding: 4px !important;
            min-height: 20px;
            outline: none;
        }
        
        .note { color: red; font-size: 11px; font-style: italic; margin: 10px 0; text-align: center; }

        /* COMMENTS FOOTER */
        .comment-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 20px; }
        .comment-box { background: #f9f9f9; padding: 15px; border-radius: 4px; min-height: 100px; font-size: 12px; }
        .comment-header { color: #0072bc; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; display: none; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 25px; border-radius: 8px; width: 400px; }
        .modal-header { font-size: 18px; font-weight: bold; color: #0072bc; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; display: flex; justify-content: space-between; }
        .modal-row { margin-bottom: 10px; font-size: 13px; }
        .modal-row label { font-weight: bold; display: block; margin-bottom: 5px; }
        .modal-row input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-left">
            <div class="login-logo-big">vn<span>Edu</span></div>
            <div class="login-slogan">M·ªòT S·∫¢N PH·∫®M C·ª¶A T·∫¨P ƒêO√ÄN VNPT</div>
            <div class="login-illustration"></div>
        </div>
        <div class="login-right">
            <h2 class="login-title">ƒêƒÉng nh·∫≠p</h2>
            <form id="login-form">
                <div class="form-group">
                    <label class="form-label">T√™n t√†i kho·∫£n</label>
                    <input type="text" id="username" class="input-box" placeholder="T√†i kho·∫£n" value="123">
                </div>
                <div class="form-group">
                    <label class="form-label">M·∫≠t kh·∫©u</label>
                    <input type="password" id="password" class="input-box" placeholder="M·∫≠t kh·∫©u" value="123">
                    <span class="password-icon" onclick="togglePass()">üëÅ</span>
                </div>
                <div style="display:flex; gap: 10px; align-items: flex-start;">
                    <button type="submit" class="login-btn">ƒêƒÉng nh·∫≠p</button>
                    <div class="qr-section">
                        <div class="qr-box"></div>
                        <div style="font-size:10px; color:#0072bc; margin-top:5px;">(Qu√©t QR)</div>
                    </div>
                </div>
            </form>
            <div style="margin-top:20px; font-size:12px; color:#666;">
                <p>Th·∫ßy/C√¥ qu√™n m·∫≠t kh·∫©u xin vui l√≤ng li√™n h·ªá Qu·∫£n tr·ªã nh√† tr∆∞·ªùng.</p>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <span style="background:black; color:white; padding:4px 8px; border-radius:4px;">App Store</span>
                    <span style="background:black; color:white; padding:4px 8px; border-radius:4px;">Google Play</span>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboard-screen">
        <div class="top-bar">
            <div style="font-size:20px; font-weight:bold;">vnEdu üéì</div>
            <div class="user-info" onclick="toggleLogout()">
                <div style="text-align:right">
                    <div style="font-size: 10px; opacity: 0.8;">Xin ch√†o,</div>
                    <div style="font-weight:bold; font-size:13px;" id="user-display-name">Nguy·ªÖn Tr·ªçng Th·∫ø S∆°n ‚ñº</div>
                </div>
                <div class="user-avatar">üë§</div>
                <div class="logout-menu" id="logoutMenu">
                    <div onclick="showModal('modal-account')">Th√¥ng tin t√†i kho·∫£n</div>
                    <div onclick="showModal('modal-password')">ƒê·ªïi m·∫≠t kh·∫©u</div>
                    <div onclick="doLogout(event)" style="color: red;">ƒêƒÉng xu·∫•t</div>
                </div>
            </div>
        </div>

        <div class="sub-header">
            <div class="student-title" id="class-title">Nguy·ªÖn Tr·ªçng Th·∫ø S∆°n - 12A2</div>
            <div class="school-name">THPT L√™ H·ªìng Phong</div>
            <div style="width: 100px; height: 3px; background: #0072bc; margin: 10px auto 0;"></div>
        </div>

        <div class="container">
            <div class="filter-row">
                <div style="display: flex; align-items: center;">
                    <div style="font-weight:bold; color:#333;" id="page-title">K·∫øt qu·∫£ h·ªçc t·∫≠p: Nguy·ªÖn Tr·ªçng Th·∫ø S∆°n - 12A2</div>
                    <button id="update-btn" class="update-btn" onclick="saveChanges()">C·∫¨P NH·∫¨T</button>
                </div>
                <div class="filters">
                    <label>NƒÉm h·ªçc</label>
                    <select id="sel-year" onchange="updateData()">
                        <option value="2024-2025">2024-2025</option>
                        <option value="2023-2024">2023-2024</option>
                        <option value="2022-2023">2022-2023</option>
                    </select>
                    <label>H·ªçc k·ª≥</label>
                    <select id="sel-sem" onchange="updateData()">
                        <option value="ca_nam">C·∫£ nƒÉm</option>
                        <option value="hk1">H·ªçc k·ª≥ 1</option>
                        <option value="hk2">H·ªçc k·ª≥ 2</option>
                    </select>
                </div>
            </div>

            <div id="main-content"></div>

        </div>
    </div>

    <div id="modal-account" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><span>Th√¥ng tin</span><span onclick="closeModal('modal-account')" style="cursor:pointer">‚úñ</span></div>
            <p>H·ªç t√™n: Nguy·ªÖn Tr·ªçng Th·∫ø S∆°n</p>
            <p>T√†i kho·∫£n: theson2182007</p>
            <p>Tr∆∞·ªùng: THPT L√™ H·ªìng Phong</p>
        </div>
    </div>

    <div id="modal-password" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><span>ƒê·ªïi m·∫≠t kh·∫©u</span><span onclick="closeModal('modal-password')" style="cursor:pointer">‚úñ</span></div>
            <div class="modal-row"><label>M·∫≠t kh·∫©u c≈©</label><input type="password"></div>
            <div class="modal-row"><label>M·∫≠t kh·∫©u m·ªõi</label><input type="password"></div>
            <button class="login-btn" onclick="alert('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!'); closeModal('modal-password')">C·∫≠p nh·∫≠t</button>
        </div>
    </div>

    <script>
        // --- GLOBAL VARIABLES ---
        let isAdmin = false;
        let currentUsername = "";
        
        // --- INITIAL DATA ---
        const subjects = ["To√°n h·ªçc", "V·∫≠t l√≠", "H√≥a h·ªçc", "Sinh h·ªçc", "Tin h·ªçc", "Ng·ªØ vƒÉn", "L·ªãch s·ª≠", "Ngo·∫°i ng·ªØ", "Gi√°o d·ª•c qu·ªëc ph√≤ng v√† an ninh"];
        const commentSubjects = ["Gi√°o d·ª•c th·ªÉ ch·∫•t", "N·ªôi dung gi√°o d·ª•c c·ªßa ƒë·ªãa ph∆∞∆°ng", "Ho·∫°t ƒë·ªông tr·∫£i nghi·ªám, h∆∞·ªõng nghi·ªáp"];

        // Comments database
        const goodComments = [
            "H·ªçc sinh xu·∫•t s·∫Øc, c√≥ t∆∞ duy logic t·ªët",
            "R·∫•t chƒÉm ch·ªâ, t√≠ch c·ª±c ph√°t bi·ªÉu x√¢y d·ª±ng b√†i",
            "C√≥ nƒÉng khi·∫øu ƒë·∫∑c bi·ªát v·ªõi m√¥n h·ªçc n√†y",
            "Lu√¥n ho√†n th√†nh b√†i t·∫≠p ƒë·∫ßy ƒë·ªß v√† ch·∫•t l∆∞·ª£ng cao",
            "C√≥ s·ª± ti·∫øn b·ªô v∆∞·ª£t b·∫≠c, x·ª©ng ƒë√°ng l√† t·∫•m g∆∞∆°ng h·ªçc t·∫≠p",
            "Th·ªÉ hi·ªán kh·∫£ nƒÉng l√£nh ƒë·∫°o nh√≥m t·ªët",
            "C√≥ tinh th·∫ßn t·ª± h·ªçc r·∫•t cao",
            "Lu√¥n s√°ng t·∫°o trong c√°ch gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ",
            "C√≥ th√°i ƒë·ªô h·ªçc t·∫≠p nghi√™m t√∫c v√† ƒë√°ng khen ng·ª£i",
            "Th√†nh t√≠ch h·ªçc t·∫≠p xu·∫•t s·∫Øc, duy tr√¨ t·ªët phong ƒë·ªô"
        ];

        const homeroomTeacherComments = [
            "H·ªçc sinh ngoan ngo√£n, l·ªÖ ph√©p, c√≥ √Ω th·ª©c t·ªï ch·ª©c k·ª∑ lu·∫≠t t·ªët",
            "T√≠ch c·ª±c tham gia c√°c ho·∫°t ƒë·ªông t·∫≠p th·ªÉ c·ªßa l·ªõp v√† tr∆∞·ªùng",
            "C√≥ tinh th·∫ßn tr√°ch nhi·ªám cao, ƒë∆∞·ª£c b·∫°n b√® v√† th·∫ßy c√¥ qu√Ω m·∫øn",
            "Lu√¥n ƒëi ƒë·∫ßu trong c√°c phong tr√†o thi ƒëua c·ªßa l·ªõp",
            "C√≥ kh·∫£ nƒÉng qu·∫£n l√Ω th·ªùi gian v√† t·ªï ch·ª©c c√¥ng vi·ªác hi·ªáu qu·∫£"
        ];

        const principalComments = [
            "H·ªçc sinh xu·∫•t s·∫Øc to√†n di·ªán, x·ª©ng ƒë√°ng l√† t·∫•m g∆∞∆°ng s√°ng cho to√†n tr∆∞·ªùng",
            "Th√†nh t√≠ch h·ªçc t·∫≠p v√† r√®n luy·ªán ƒë√°ng t·ª± h√†o, ti·∫øp t·ª•c ph√°t huy",
            "ƒê·∫°t nhi·ªÅu th√†nh t√≠ch n·ªïi b·∫≠t, ƒë√≥ng g√≥p t√≠ch c·ª±c cho nh√† tr∆∞·ªùng",
            "L√† h·ªçc sinh ti√™u bi·ªÉu c·ªßa tr∆∞·ªùng trong nƒÉm h·ªçc n√†y"
        ];

        // Initialize database
        let db = {
            "2024-2025": { class: "12A2", data: null },
            "2023-2024": { class: "11A2", data: null },
            "2022-2023": { class: "10A2", data: null }
        };

        // Helper functions
        function randScore(min, max) { 
            return (Math.random() * (max - min) + min).toFixed(1); 
        }
        
        function randInt(min, max) { 
            return Math.floor(Math.random() * (max - min + 1) + min); 
        }

        // Initialize database with random data
        function initDB() {
            for (let year in db) {
                let subjectsData = [];
                subjects.forEach(sub => {
                    // All scores above 8.0
                    let tx1 = [randInt(8,10), randInt(8,10), randInt(8,10), randInt(8,10)];
                    let gk1 = randScore(8.0, 10.0);
                    let ck1 = randScore(8.0, 10.0);
                    let tbm1 = ((parseFloat(gk1)*2 + parseFloat(ck1)*3 + tx1.reduce((a,b)=>a+b,0))/ (5 + tx1.length)).toFixed(1);
                    
                    let tx2 = [randInt(8,10), randInt(8,10), randInt(8,10)];
                    let gk2 = randScore(8.0, 10.0);
                    let ck2 = randScore(8.0, 10.0);
                    let tbm2 = ((parseFloat(gk2)*2 + parseFloat(ck2)*3 + tx2.reduce((a,b)=>a+b,0))/ (5 + tx2.length)).toFixed(1);
                    
                    let tbmCN = ((parseFloat(tbm1) + parseFloat(tbm2)*2)/3).toFixed(1);

                    // Random comments for each subject
                    subjectsData.push({
                        name: sub,
                        hk1: { 
                            tx: tx1.join(" | "), 
                            gk: gk1, 
                            ck: ck1, 
                            tbm: tbm1,
                            comment: goodComments[Math.floor(Math.random() * goodComments.length)]
                        },
                        hk2: { 
                            tx: tx2.join(" | "), 
                            gk: gk2, 
                            ck: ck2, 
                            tbm: tbm2,
                            comment: goodComments[Math.floor(Math.random() * goodComments.length)]
                        },
                        cn: { 
                            tbm: tbmCN,
                            comment: goodComments[Math.floor(Math.random() * goodComments.length)]
                        }
                    });
                });
                
                let comData = [];
                commentSubjects.forEach(sub => { 
                    comData.push({ 
                        name: sub, 
                        res: "ƒê",
                        comment: goodComments[Math.floor(Math.random() * goodComments.length)]
                    }); 
                });
                
                // Random comments for homeroom teacher and principal
                db[year].data = { 
                    scoreSubs: subjectsData, 
                    comSubs: comData,
                    homeroomComment: homeroomTeacherComments[Math.floor(Math.random() * homeroomTeacherComments.length)],
                    principalComment: principalComments[Math.floor(Math.random() * principalComments.length)]
                };
            }
        }

        // Load data from localStorage or initialize
        function loadData() {
            const savedData = localStorage.getItem('vnedu_data');
            if (savedData) {
                db = JSON.parse(savedData);
            } else {
                initDB();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('vnedu_data', JSON.stringify(db));
        }

        // --- RENDER FUNCTIONS ---
        function updateData() {
            const year = document.getElementById("sel-year").value;
            const sem = document.getElementById("sel-sem").value;
            const currentDB = db[year];
            
            // Update titles
            const title = `Nguy·ªÖn Tr·ªçng Th·∫ø S∆°n - ${currentDB.class}`;
            document.getElementById("class-title").innerText = title;
            document.getElementById("page-title").innerText = `K·∫øt qu·∫£ h·ªçc t·∫≠p: ${title}`;

            // Show/hide update button and enable editing
            const updateBtn = document.getElementById("update-btn");
            if (isAdmin) {
                updateBtn.style.display = "inline-block";
                document.getElementById("class-title").contentEditable = "true";
                document.querySelector(".school-name").contentEditable = "true";
                document.getElementById("page-title").contentEditable = "true";
                document.getElementById("class-title").classList.add("editable-cell");
                document.querySelector(".school-name").classList.add("editable-cell");
                document.getElementById("page-title").classList.add("editable-cell");
            } else {
                updateBtn.style.display = "none";
                document.getElementById("class-title").contentEditable = "false";
                document.querySelector(".school-name").contentEditable = "false";
                document.getElementById("page-title").contentEditable = "false";
                document.getElementById("class-title").classList.remove("editable-cell");
                document.querySelector(".school-name").classList.remove("editable-cell");
                document.getElementById("page-title").classList.remove("editable-cell");
            }

            const contentDiv = document.getElementById("main-content");
            let html = "";
            
            // Summary section
            html += `
            <div class="summary-grid">
                <div>
                    <div class="card-title">üìù T·ªîNG K·∫æT</div>
                    <div style="display: flex; gap: 10px;">
                        <div class="result-box" style="flex:1">
                            <div class="result-row"><span style="color:#009900; font-weight:bold;">üè´ H·ªçc t·∫≠p</span> <span class="badge badge-tot" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>Xu·∫•t s·∫Øc</span></div>
                            <div class="result-row"><span>H·ªçc k·ª≥ 1</span> <span ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>Xu·∫•t s·∫Øc</span></div>
                            <div class="result-row"><span>H·ªçc k·ª≥ 2</span> <span ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>Xu·∫•t s·∫Øc</span></div>
                        </div>
                        <div class="result-box" style="flex:1">
                            <div class="result-row"><span style="color:#9933cc; font-weight:bold;">üå∑ R√®n luy·ªán</span> <span class="badge badge-tot" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>T·ªët</span></div>
                            <div class="result-row"><span>H·ªçc k·ª≥ 1</span> <span ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>T·ªët</span></div>
                            <div class="result-row"><span>H·ªçc k·ª≥ 2</span> <span ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>T·ªët</span></div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="card-title">üìÖ CHUY√äN C·∫¶N</div>
                    <div class="result-box" style="display: flex; justify-content: space-between;">
                        <div style="flex: 1; padding-right: 10px; border-right: 1px solid #ddd;">
                            <div class="result-row"><span style="font-weight:bold">Ngh·ªâ c√≥ ph√©p</span> <span style="color:#009900; font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>0 bu·ªïi</span></div>
                            <div class="result-row"><span>H·ªçc k·ª≥ 1</span> <span ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>0 bu·ªïi</span></div>
                            <div class="result-row"><span>H·ªçc k·ª≥ 2</span> <span ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>0 bu·ªïi</span></div>
                        </div>
                        <div style="flex: 1; padding-left: 10px;">
                            <div class="result-row"><span style="font-weight:bold">Kh√¥ng ph√©p</span> <span style="color:#009900; font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>0 bu·ªïi</span></div>
                            <div class="result-row"><span>H·ªçc k·ª≥ 1</span> <span ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>0 bu·ªïi</span></div>
                            <div class="result-row"><span>H·ªçc k·ª≥ 2</span> <span ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>0 bu·ªïi</span></div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="card-title">üèÜ KHEN TH∆Ø·ªûNG</div>
                    <div style="display: flex; gap: 10px;">
                        <div class="award-box" style="flex:1">
                            <span style="font-size:25px">üèÜ</span><br>
                            <b>Danh hi·ªáu</b><br><span style="color:#333" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>H·ªçc sinh xu·∫•t s·∫Øc</span>
                        </div>
                        <div class="award-box" style="flex:1">
                            <span style="font-size:25px">üéó</span><br>
                            <b>Khen th∆∞·ªüng ƒêB</b><br><span style="color:#333" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>Gi·∫£i Nh·∫•t HSG To√°n</span>
                        </div>
                    </div>
                </div>
            </div>`;

            html += `<div class="card-title">üìÑ B·∫¢NG ƒêI·ªÇM</div>`;
            html += `<div class="table-section-title">ƒê√ÅNH GI√Å B·∫∞NG NH·∫¨N X√âT K·∫æT H·ª¢P ƒêI·ªÇM S·ªê</div>`;
            
            if (sem === "ca_nam") {
                html += `<table class="score-table"><thead><tr>
                    <th style="width:20%">M√¥n h·ªçc</th>
                    <th>H·ªçc k·ª≥ 1</th>
                    <th>ƒêi·ªÉm MT HK1</th>
                    <th>H·ªçc k·ª≥ 2</th>
                    <th>ƒêi·ªÉm MT HK2</th>
                    <th>TBM</th>
                    <th>ƒêi·ªÉm MT CN</th>
                    <th>Thi l·∫°i</th>
                    <th>Nh·∫≠n x√©t c·ªßa gi√°o vi√™n</th>
                </tr></thead><tbody>`;
                
                currentDB.data.scoreSubs.forEach((s, index) => {
                    html += `<tr>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.name}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.hk1.tbm}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${(parseFloat(s.hk1.tbm)+0.5).toFixed(1)}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.hk2.tbm}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${(parseFloat(s.hk2.tbm)+0.5).toFixed(1)}</td>
                        <td style="font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.cn.tbm}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${(parseFloat(s.cn.tbm)+0.5).toFixed(1)}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}></td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.cn.comment}</td>
                    </tr>`;
                });
                
                html += `</tbody></table>`;
                html += `<div class="table-section-title">ƒê√ÅNH GI√Å B·∫∞NG NH·∫¨N X√âT</div>`;
                html += `<table class="score-table"><thead><tr>
                    <th style="width:20%">M√¥n h·ªçc</th>
                    <th>H·ªçc k·ª≥ 1</th>
                    <th>H·ªçc k·ª≥ 2</th>
                    <th>TBM</th>
                    <th>Thi l·∫°i</th>
                    <th>Nh·∫≠n x√©t c·ªßa gi√°o vi√™n</th>
                </tr></thead><tbody>`;
                
                currentDB.data.comSubs.forEach((s, index) => {
                    html += `<tr>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.name}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>ƒê</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>ƒê</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>ƒê</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}></td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.comment}</td>
                    </tr>`;
                });
                
                html += `</tbody></table>`;
                html += `<div class="comment-grid">
                    <div class="comment-box"><div class="comment-header">üèÖ X√âT HO√ÄN TH√ÄNH CH∆Ø∆†NG TR√åNH L·ªöP H·ªåC</div><div ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>ƒê·ªß ƒëi·ªÅu ki·ªán d·ª± thi t·ªët nghi·ªáp v·ªõi th√†nh t√≠ch xu·∫•t s·∫Øc</div></div>
                    <div class="comment-box"><div class="comment-header">üë§ NH·∫¨N X√âT C·ª¶A GVCN</div><div ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${currentDB.data.homeroomComment}</div></div>
                    <div class="comment-box"><div class="comment-header">üè´ NH·∫¨N X√âT C·ª¶A HI·ªÜU TR∆Ø·ªûNG</div><div ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${currentDB.data.principalComment}</div></div>
                </div>`;
            } else {
                const isHK1 = (sem === 'hk1');
                html += `<table class="score-table"><thead><tr>
                    <th style="width:15%">M√¥n h·ªçc</th>
                    <th style="width:30%">ƒê√°nh gi√° th∆∞·ªùng xuy√™n</th>
                    <th>Gi·ªØa k·ª≥</th>
                    <th>Cu·ªëi k·ª≥</th>
                    <th>TBM</th>
                    <th>ƒêi·ªÉm MT</th>
                    <th>Nh·∫≠n x√©t c·ªßa gi√°o vi√™n</th>
                </tr></thead><tbody>`;
                
                currentDB.data.scoreSubs.forEach((s, index) => {
                    let d = isHK1 ? s.hk1 : s.hk2;
                    html += `<tr>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.name}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${d.tx}</td>
                        <td style="font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${d.gk}</td>
                        <td style="font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${d.ck}</td>
                        <td style="font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${d.tbm}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${(parseFloat(d.tbm)+0.5).toFixed(1)}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${d.comment}</td>
                    </tr>`;
                });
                
                html += `</tbody></table>`;
                html += `<div class="table-section-title">ƒê√ÅNH GI√Å B·∫∞NG NH·∫¨N X√âT K·∫æT H·ª¢P ƒêI·ªÇM S·ªê (M√¥n ƒë√°nh gi√°)</div>`;
                html += `<table class="score-table"><thead><tr>
                    <th style="width:15%">M√¥n h·ªçc</th>
                    <th style="width:30%">ƒê√°nh gi√° th∆∞·ªùng xuy√™n</th>
                    <th>Gi·ªØa k·ª≥</th>
                    <th>Cu·ªëi k·ª≥</th>
                    <th>TBM</th>
                    <th>Nh·∫≠n x√©t c·ªßa gi√°o vi√™n</th>
                </tr></thead><tbody>`;
                
                currentDB.data.comSubs.forEach((s, index) => {
                    html += `<tr>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.name}</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>ƒê | ƒê | ƒê</td>
                        <td style="font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>ƒê</td>
                        <td style="font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>ƒê</td>
                        <td style="font-weight:bold" ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>1</td>
                        <td ${isAdmin ? 'contenteditable="true" class="editable-cell"' : ''}>${s.comment}</td>
                    </tr>`;
                });
                
                html += `</tbody></table>`;
            }

            html += `<div class="note">L∆∞u √Ω: ƒêi·ªÉm MT ho·∫∑c ƒêMT l√† vi·∫øt t·∫Øt c·ªßa ƒêi·ªÉm m·ª•c ti√™u</div>`;
            contentDiv.innerHTML = html;
        }

        // --- SAVE FUNCTION ---
        function saveChanges() {
            if (!isAdmin) {
                alert("Ch·ªâ qu·∫£n tr·ªã vi√™n m·ªõi c√≥ quy·ªÅn c·∫≠p nh·∫≠t!");
                return;
            }

            const year = document.getElementById("sel-year").value;
            const sem = document.getElementById("sel-sem").value;
            const currentDB = db[year].data;

            // Save titles
            db[year].class = document.getElementById("class-title").innerText.split(" - ")[1] || "12A2";
            
            // Collect data from editable cells
            if (sem === "ca_nam") {
                // Save subject scores and comments
                const rows = document.querySelectorAll("#main-content .score-table tbody tr");
                rows.forEach((row, index) => {
                    if (index < currentDB.scoreSubs.length) {
                        const cells = row.querySelectorAll("td");
                        currentDB.scoreSubs[index].hk1.tbm = cells[1].innerText.trim();
                        currentDB.scoreSubs[index].hk2.tbm = cells[3].innerText.trim();
                        currentDB.scoreSubs[index].cn.tbm = cells[5].innerText.trim();
                        currentDB.scoreSubs[index].cn.comment = cells[8].innerText.trim();
                    }
                });
                
                // Save comments for evaluated subjects
                const comRows = document.querySelectorAll("#main-content .score-table:nth-of-type(2) tbody tr");
                comRows.forEach((row, index) => {
                    if (index < currentDB.comSubs.length) {
                        const cells = row.querySelectorAll("td");
                        currentDB.comSubs[index].comment = cells[5].innerText.trim();
                    }
                });
                
                // Save comments from comment boxes
                const commentBoxes = document.querySelectorAll("#main-content .comment-box > div:last-child");
                if (commentBoxes.length >= 3) {
                    currentDB.homeroomComment = commentBoxes[1].innerText.trim();
                    currentDB.principalComment = commentBoxes[2].innerText.trim();
                }
            } else {
                const isHK1 = (sem === 'hk1');
                const rows = document.querySelectorAll("#main-content .score-table tbody tr");
                rows.forEach((row, index) => {
                    if (index < currentDB.scoreSubs.length) {
                        const cells = row.querySelectorAll("td");
                        if (isHK1) {
                            currentDB.scoreSubs[index].hk1.tx = cells[1].innerText.trim();
                            currentDB.scoreSubs[index].hk1.gk = cells[2].innerText.trim();
                            currentDB.scoreSubs[index].hk1.ck = cells[3].innerText.trim();
                            currentDB.scoreSubs[index].hk1.tbm = cells[4].innerText.trim();
                            currentDB.scoreSubs[index].hk1.comment = cells[6].innerText.trim();
                        } else {
                            currentDB.scoreSubs[index].hk2.tx = cells[1].innerText.trim();
                            currentDB.scoreSubs[index].hk2.gk = cells[2].innerText.trim();
                            currentDB.scoreSubs[index].hk2.ck = cells[3].innerText.trim();
                            currentDB.scoreSubs[index].hk2.tbm = cells[4].innerText.trim();
                            currentDB.scoreSubs[index].hk2.comment = cells[6].innerText.trim();
                        }
                    }
                });
            }

            // Save to localStorage
            saveData();
            
            alert("‚úÖ D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!");
        }

        // --- LOGIN FUNCTIONS ---
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            
            // Admin account: 123/123
            if (username === "123" && password === "123") {
                isAdmin = true;
                currentUsername = "admin";
                document.getElementById("login-screen").style.display = "none";
                document.getElementById("dashboard-screen").style.display = "block";
                document.getElementById("user-display-name").innerHTML = "Qu·∫£n tr·ªã vi√™n ‚ñº";
                document.querySelector(".user-info > div > div:first-child").innerHTML = "Xin ch√†o Admin,";
                
                loadData();
                updateData();
                alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng v·ªõi quy·ªÅn Qu·∫£n tr·ªã vi√™n! B·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a m·ªçi th√¥ng tin v√† nh·∫•n n√∫t C·∫¨P NH·∫¨T ƒë·ªÉ l∆∞u.");
            } 
            // Student account
            else if (username === "theson2182007" && password === "0984326031") {
                isAdmin = false;
                currentUsername = "theson2182007";
                document.getElementById("login-screen").style.display = "none";
                document.getElementById("dashboard-screen").style.display = "block";
                document.getElementById("user-display-name").innerHTML = "Nguy·ªÖn Tr·ªçng Th·∫ø S∆°n ‚ñº";
                document.querySelector(".user-info > div > div:first-child").innerHTML = "Xin ch√†o PHHS,";
                
                loadData();
                updateData();
                alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Ch·∫ø ƒë·ªô xem ch·ªâ ƒë·ªçc.");
            } 
            else {
                alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
                return false;
            }
        }

        // --- UTILITY FUNCTIONS ---
        function togglePass() {
            const passwordInput = document.getElementById("password");
            passwordInput.type = passwordInput.type === "password" ? "text" : "password";
        }

        function toggleLogout() {
            const menu = document.getElementById("logoutMenu");
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        }

        function doLogout(event) {
            event.stopPropagation();
            if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?")) {
                isAdmin = false;
                currentUsername = "";
                document.getElementById("dashboard-screen").style.display = "none";
                document.getElementById("login-screen").style.display = "flex";
            }
        }
        
        function showModal(id) {
            document.getElementById(id).style.display = 'flex';
            document.getElementById("logoutMenu").style.display = "none";
        }
        
        function closeModal(id) { 
            document.getElementById(id).style.display = 'none'; 
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', function() {
            // Set up login form
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            
            // Load data
            loadData();
            
            // Close logout menu when clicking outside
            window.addEventListener('click', function(event) {
                if (!event.target.closest('.user-info')) {
                    document.getElementById("logoutMenu").style.display = "none";
                }
            });
        });
    </script>
</body>
</html>